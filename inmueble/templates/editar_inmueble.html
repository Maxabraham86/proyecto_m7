{% extends 'base.html' %}




{% block content %}
<h3 class="text-center"> Editando la Propiedad
    {{inmueble}}
</h3>


<form action="{% url 'editar_inmueble' id=inmueble.id %}" method="post">
    {% csrf_token %}
    <div class="row">
        <div class="col-4 p-3">
            <div class="mb-3">
                <label for="nombre" class="form-label">Nombre</label>
                <input type="text" class="form-control" name="nombre" id="nombre" value="{{inmueble.nombre}}" required
                    placeholder="nombre de la propiedad" required>
            </div>

            <div class="mb-3">
                <label for="descripcion" class="form-label">Descripción:</label>
                <textarea name="descripcion" class="form-control" id="descripcion" rows="3" required maxlength="1500" placeholder="breve descripción...">{{inmueble.descripcion}}</textarea>
            </div>
    
            
            <div class="mb-3">
            <label for="nombre" class="form-label">Metros Construídos:</label>
            <input min="1" name="M2_construidos" type="number" class="form-control" id="M2_construidos" required placeholder="23 m^2" value="{{inmueble.M2_construidos}}">
            </div>
        
            <div class="mb-3">
            <label for="nombre" class="form-label">Metros Totales de Terreno:</label>
            <input min="1" name="M2_totales_terreno" type="number" class="form-control" id="M2_totales_terreno" required placeholder="50 m^2" value="{{inmueble.M2_totales_terreno}}">
            </div>
        </div>

        
        <div class="col-4 p-3">
            <div class="mb-3">
                <label for="nombre" class="form-label">Cant. Estacionamientos:</label>
                <input min="0"  name="cant_estacionamientos" type="number" class="form-control" id="cant_estacionamientos" required placeholder="num" value="{{inmueble.cant_estacionamientos}}">
            </div>
            
            <div class="mb-3">
                <label for="nombre" class="form-label">Cant. habitaciones:</label>
                <input min="0"  name="cant_habitaciones" type="number" class="form-control" id="cant_habitaciones" required placeholder="num" value="{{inmueble.cant_habitaciones}}">
            </div>

            <div class="mb-3">
                <label for="nombre" class="form-label">Cant. baños:</label>
                <input min="0"  name="cant_banos" type="number" class="form-control" id="cant_banos" required placeholder="num" value="{{inmueble.cant_banos}}">
            </div>

            <div class="mb-3">
                <label for="nombre" class="form-label">Direccion</label>
                <input type="text" class="form-control" name="direccion" id="direccion" required
                    placeholder="tu direccion" value="{{inmueble.direccion}}">
            </div>

        </div>
        
            <div class="col-4 p-3">
                <div class="mb-3">
                    <select class="form-select" required name="tipo_vivienda">
                        <option value>Selecciona un tipo</option>
                        {% for tt in inmueble.inmueble_tipo %}
                        <option 
                        value="{{ tt.0 }}"
                        {% if tt.0 == inmueble.tipo_vivienda %}selected {% endif %}
                        >{{ tt.1 }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="mb-3">
                    <label for="nombre" class="form-label">Precio (CLP)</label>
                    <input min="1000" name="precio_mensual" type="number" class="form-control" id="precio_mensual" required placeholder="$250.000" value="{{inmueble.precio_mensual}}">
                </div>
                
                <div class="mb-3">
                    <select class="form-select" required name="region_cod" id="region_cod">
                        <option value>Selecciona una region </option>
                        {% for region in regiones %}
                        <option value="{{ region.cod }}" {% if region.cod == cod_region %} selected {% endif %}>{{ region.nombre }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="mb-3">
                    <select class="form-select" required name="comuna_cod" id="comuna_cod">
                        <option value>Selecciona una Comuna </option>
                        {% for comuna in comunas %}
                        <option value="{{ comuna.cod }}" {% if comuna.cod == inmueble.comuna_id %} selected {% endif%} >{{ comuna.nombre }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                
            </div>
    </div>
        <div class="text-center">
            <button type= "submit" class="btn btn-success"> Editar Inmueble</button>

        </div>
</form>
{% endblock %}





{% block js %}
        <script>
            function filtrar_comunas (){
                //recuperamos el valor seleccionado de la region
                const cod_seleccionado = $(this).val()
                console.log(cod_seleccionado)
                // ahora iteramos sobre todas las comunas, y mostramos sólo aquellas cuyo código tenga como prefijo  el codigo de la region seleccionada 
                $('#comuna_cod option').each(function() {
                    const comuna=$(this);
                    const cod_comuna = comuna.val()
                    if (cod_seleccionado == cod_comuna.substring(0,2)){
                        // la comuna es parte de la region
                        comuna.show()

                    } else{
                        comuna.hide()
                    }
                })
            }

            $('#region_cod').on('change', filtrar_comunas)

        </script>

{% endblock %}


